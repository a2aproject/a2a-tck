/home/maeste/project/a2a-workspace/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:208: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.13.2, pytest-8.3.5, pluggy-1.6.0 -- /home/maeste/project/a2a-workspace/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/maeste/project/a2a-workspace/a2a-tck
configfile: pyproject.toml
testpaths: tests
plugins: anyio-4.9.0, asyncio-1.0.0
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 75 items

tests/test_agent_card.py::test_agent_card_available PASSED               [  1%]
tests/test_agent_card.py::test_mandatory_fields_present PASSED           [  2%]
tests/test_agent_card.py::test_mandatory_field_types PASSED              [  4%]
tests/test_agent_card.py::test_capabilities_structure PASSED             [  5%]
tests/test_agent_card.py::test_authentication_structure SKIPPED (Age...) [  6%]
tests/test_agent_card_utils.py::test_fetch_agent_card_success PASSED     [  8%]
tests/test_agent_card_utils.py::test_fetch_agent_card_not_found PASSED   [  9%]
tests/test_agent_card_utils.py::test_fetch_agent_card_invalid_json PASSED [ 10%]
tests/test_agent_card_utils.py::test_get_sut_rpc_endpoint PASSED         [ 12%]
tests/test_agent_card_utils.py::test_get_capability_streaming PASSED     [ 13%]
tests/test_agent_card_utils.py::test_get_capability_push_notifications PASSED [ 14%]
tests/test_agent_card_utils.py::test_get_supported_modalities PASSED     [ 16%]
tests/test_agent_card_utils.py::test_get_authentication_schemes PASSED   [ 17%]
tests/test_authentication.py::test_auth_schemes_available PASSED         [ 18%]
tests/test_authentication.py::test_missing_authentication XFAIL (SDK...) [ 20%]
tests/test_authentication.py::test_invalid_authentication XFAIL (SDK...) [ 21%]
tests/test_concurrency.py::test_parallel_requests PASSED                 [ 22%]
tests/test_concurrency.py::test_rapid_sequential_requests PASSED         [ 24%]
tests/test_concurrency.py::test_concurrent_operations_same_task PASSED   [ 25%]
tests/test_edge_cases.py::test_very_long_string PASSED                   [ 26%]
tests/test_edge_cases.py::test_empty_arrays FAILED                       [ 28%]
tests/test_edge_cases.py::test_null_optional_fields PASSED               [ 29%]
tests/test_edge_cases.py::test_unexpected_json_types PASSED              [ 30%]
tests/test_edge_cases.py::test_extra_fields PASSED                       [ 32%]
tests/test_edge_cases.py::test_unicode_and_special_chars PASSED          [ 33%]
tests/test_edge_cases.py::test_boundary_values FAILED                    [ 34%]
tests/test_invalid_business_logic.py::test_unsupported_part_kind FAILED  [ 36%]
tests/test_invalid_business_logic.py::test_invalid_file_part PASSED      [ 37%]
tests/test_invalid_business_logic.py::test_empty_message_parts FAILED    [ 38%]
tests/test_invalid_business_logic.py::test_very_large_message PASSED     [ 40%]
tests/test_invalid_business_logic.py::test_missing_required_message_fields PASSED [ 41%]
tests/test_json_rpc_compliance.py::test_rejects_malformed_json PASSED    [ 42%]
tests/test_json_rpc_compliance.py::test_rejects_invalid_json_rpc_requests[invalid_request0--32600] PASSED [ 44%]
tests/test_json_rpc_compliance.py::test_rejects_invalid_json_rpc_requests[invalid_request1--32601] PASSED [ 45%]
tests/test_json_rpc_compliance.py::test_rejects_invalid_json_rpc_requests[invalid_request2--32600] PASSED [ 46%]
tests/test_json_rpc_compliance.py::test_rejects_invalid_json_rpc_requests[invalid_request3--32602] PASSED [ 48%]
tests/test_json_rpc_compliance.py::test_rejects_unknown_method PASSED    [ 49%]
tests/test_json_rpc_compliance.py::test_rejects_invalid_params PASSED    [ 50%]
tests/test_message_send_method.py::test_message_send_valid_text PASSED   [ 52%]
tests/test_message_send_method.py::test_message_send_invalid_params PASSED [ 53%]
tests/test_message_send_method.py::test_message_send_valid_file_part SKIPPED [ 54%]
tests/test_message_send_method.py::test_message_send_valid_multiple_parts SKIPPED [ 56%]
tests/test_message_send_method.py::test_message_send_continue_task PASSED [ 57%]
tests/test_message_send_method.py::test_message_send_continue_nonexistent_task PASSED [ 58%]
tests/test_message_send_method.py::test_message_send_continue_with_contextid PASSED [ 60%]
tests/test_message_send_method.py::test_message_send_valid_data_part SKIPPED [ 61%]
tests/test_message_send_method.py::test_message_send_data_part_array SKIPPED [ 62%]
tests/test_protocol_violations.py::test_duplicate_request_ids PASSED     [ 64%]
tests/test_protocol_violations.py::test_invalid_jsonrpc_version PASSED   [ 65%]
tests/test_protocol_violations.py::test_missing_method_field FAILED      [ 66%]
tests/test_protocol_violations.py::test_raw_invalid_json PASSED          [ 68%]
tests/test_push_notification_config_methods.py::test_set_push_notification_config FAILED [ 69%]
tests/test_push_notification_config_methods.py::test_get_push_notification_config FAILED [ 70%]
tests/test_push_notification_config_methods.py::test_set_push_notification_config_nonexistent FAILED [ 72%]
tests/test_push_notification_config_methods.py::test_get_push_notification_config_nonexistent FAILED [ 73%]
tests/test_reference_task_ids.py::test_reference_task_ids_valid SKIPPED  [ 74%]
tests/test_reference_task_ids.py::test_reference_task_ids_invalid PASSED [ 76%]
tests/test_resilience.py::test_streaming_reconnection_simulation PASSED  [ 77%]
tests/test_resilience.py::test_partial_update_recovery PASSED            [ 78%]
tests/test_sdk_limitations.py::test_history_length_parameter_compliance XFAIL [ 80%]
tests/test_state_transitions.py::test_task_state_transitions PASSED      [ 81%]
tests/test_state_transitions.py::test_task_history_length FAILED         [ 82%]
tests/test_streaming_methods.py::test_message_stream_basic PASSED        [ 84%]
tests/test_streaming_methods.py::test_message_stream_invalid_params PASSED [ 85%]
tests/test_streaming_methods.py::test_tasks_resubscribe PASSED           [ 86%]
tests/test_streaming_methods.py::test_tasks_resubscribe_nonexistent FAILED [ 88%]
tests/test_tasks_cancel_method.py::test_tasks_cancel_valid PASSED        [ 89%]
tests/test_tasks_cancel_method.py::test_tasks_cancel_nonexistent PASSED  [ 90%]
tests/test_tasks_cancel_method.py::test_tasks_cancel_already_canceled PASSED [ 92%]
tests/test_tasks_get_method.py::test_tasks_get_valid PASSED              [ 93%]
tests/test_tasks_get_method.py::test_tasks_get_with_history_length PASSED [ 94%]
tests/test_tasks_get_method.py::test_tasks_get_nonexistent PASSED        [ 96%]
tests/test_transport_security.py::test_sut_uses_https PASSED             [ 97%]
tests/test_transport_security.py::test_http_to_https_redirect SKIPPED    [ 98%]
tests/test_transport_security.py::test_https_url_in_agent_card FAILED    [100%]

=================================== FAILURES ===================================
______________________________ test_empty_arrays _______________________________

sut_client = <tck.sut_client.SUTClient object at 0x7fccda2be9e0>

    @pytest.mark.all  # Not a core test
    def test_empty_arrays(sut_client):
        """
        Test SUT's handling of empty arrays in parameters.
        """
        # Empty parts array (should be rejected)
        params = {
            "message": {
                "messageId": "test-empty-array-message-id-" + str(uuid.uuid4()),
                "role": "user",
                "parts": []
            }
        }
    
        req = message_utils.make_json_rpc_request("message/send", params=params)
        resp = sut_client.send_json_rpc(**req)
    
        # The SUT should reject this with InvalidParams
>       assert message_utils.is_json_rpc_error_response(resp, expected_id=req["id"])
E       AssertionError: assert False
E        +  where False = <function is_json_rpc_error_response at 0x7fccda0d4400>({'id': '474131b8-3d7f-4c89-b0f6-dbfe00031371', 'jsonrpc': '2.0', 'result': {'artifacts': [{'artifactId': '76a89575-d119-4af2-b979-7a2245bbabdc', 'description': 'Agent response to user message.', 'name': 'response', 'parts': [{'kind': 'text', 'text': 'Hello! Please provide a message for me to respond to.'}]}], 'contextId': 'afb3fe3e-5b7a-44fb-b8e9-a417096a27ad', 'history': [{'contextId': 'afb3fe3e-5b7a-44fb-b8e9-a417096a27ad', 'kind': 'message', 'messageId': 'test-empty-array-message-id-c0bac929-bf15-4a23-af19-fe9ffd0b1ae3', 'parts': [], ...}], 'id': '7b2e37b5-2409-4a67-98aa-54c001e639c4', ...}}, expected_id='474131b8-3d7f-4c89-b0f6-dbfe00031371')
E        +    where <function is_json_rpc_error_response at 0x7fccda0d4400> = message_utils.is_json_rpc_error_response

tests/test_edge_cases.py:67: AssertionError
_____________________________ test_boundary_values _____________________________

sut_client = <tck.sut_client.SUTClient object at 0x7fccda2be9e0>

    @pytest.mark.all  # Not a core test
    def test_boundary_values(sut_client):
        """
        Test SUT's handling of boundary values in parameters.
        """
        # Test with minimum/maximum values for historyLength
        task_id = _create_simple_task(sut_client)
    
        # Very large historyLength (e.g., int32 max)
        large_history_req = message_utils.make_json_rpc_request(
            "tasks/get",
            params={"id": task_id, "historyLength": 2147483647}
        )
        large_history_resp = sut_client.send_json_rpc(**large_history_req)
    
        # Very small historyLength (e.g., 0)
        zero_history_req = message_utils.make_json_rpc_request(
            "tasks/get",
            params={"id": task_id, "historyLength": 0}
        )
        zero_history_resp = sut_client.send_json_rpc(**zero_history_req)
    
        # Negative historyLength (invalid)
        neg_history_req = message_utils.make_json_rpc_request(
            "tasks/get",
            params={"id": task_id, "historyLength": -1}
        )
        neg_history_resp = sut_client.send_json_rpc(**neg_history_req)
    
        # Check that positive values are accepted
        assert message_utils.is_json_rpc_success_response(large_history_resp, expected_id=large_history_req["id"])
        assert message_utils.is_json_rpc_success_response(zero_history_resp, expected_id=zero_history_req["id"])
    
        # Negative should be rejected
>       assert message_utils.is_json_rpc_error_response(neg_history_resp, expected_id=neg_history_req["id"])
E       assert False
E        +  where False = <function is_json_rpc_error_response at 0x7fccda0d4400>({'id': 'bebc2014-a45a-41e7-b25e-9f5136287af8', 'jsonrpc': '2.0', 'result': {'artifacts': [{'artifactId': '5afc7e44-6bce-4824-8b3c-9abc81414d79', 'description': 'Agent response to user message.', 'name': 'response', 'parts': [{'kind': 'text', 'text': "Hello World! You said: 'Simple task for edge case testing 99b4676d-5fd9-48c6-9732-6a5419da459c'. Thanks for your message!"}]}], 'contextId': 'd3b8d399-372d-4781-980c-7e96071a1b30', 'history': [{'contextId': 'd3b8d399-372d-4781-980c-7e96071a1b30', 'kind': 'message', 'messageId': 'test-simple-task-message-id-35ef25f0-7089-49dc-905a-82d87fcae124', 'parts': [{'kind': 'text', 'text': 'Simple task for edge case testing 99b4676d-5fd9-48c6-9732-6a5419da459c'}], ...}], 'id': 'c7a7a649-2243-47f4-a543-02063ac6ad03', ...}}, expected_id='bebc2014-a45a-41e7-b25e-9f5136287af8')
E        +    where <function is_json_rpc_error_response at 0x7fccda0d4400> = message_utils.is_json_rpc_error_response

tests/test_edge_cases.py:230: AssertionError
__________________________ test_unsupported_part_kind __________________________

sut_client = <tck.sut_client.SUTClient object at 0x7fccda0ed6e0>

    @pytest.mark.all  # Not a core test as per requirements
    def test_unsupported_part_kind(sut_client):
        """
        A2A JSON-RPC Spec: Business Logic Validation
        Test that the SUT properly rejects a message with an unsupported part type.
        """
        # Create a message with an unsupported part type
        params = {
            "message": {
                "messageId": "test-unsupported-part-message-id-" + str(uuid.uuid4()),
                "role": "user",
                "parts": [
                    {
                        "type": "unsupported_type",  # Invalid/unsupported type
                        "text": "This should be rejected"
                    }
                ]
            }
        }
    
        req = message_utils.make_json_rpc_request("message/send", params=params)
        resp = sut_client.send_json_rpc(**req)
    
        # Expect either an error response or a task with failed state
        if message_utils.is_json_rpc_error_response(resp, expected_id=req["id"]):
            # Check if it's an InvalidParamsError or other error
            assert resp["error"]["code"] in {-32602, -32603}, "Expected InvalidParamsError or InternalError (Spec: InvalidParamsError/-32602, InternalError/-32603)"
        else:
            # If not an error response, the task might be created but in a failed state
            assert message_utils.is_json_rpc_success_response(resp, expected_id=req["id"])
            task = resp["result"]
>           assert task["status"].get("state") in {"failed", "error"}, "Task should be in failed state"
E           AssertionError: Task should be in failed state
E           assert 'completed' in {'error', 'failed'}
E            +  where 'completed' = <built-in method get of dict object at 0x7fccda1fa740>('state')
E            +    where <built-in method get of dict object at 0x7fccda1fa740> = {'message': {'contextId': 'cb33612f-5482-4877-ab65-ced64eb5462e', 'kind': 'message', 'messageId': '411a8e49-f039-43ff-a514-eaf49b8b5aa9', 'parts': [{'kind': 'text', 'text': 'Hello World! Nice to meet you!'}], ...}, 'state': 'completed'}.get

tests/test_invalid_business_logic.py:43: AssertionError
___________________________ test_empty_message_parts ___________________________

sut_client = <tck.sut_client.SUTClient object at 0x7fccda0ed6e0>

    @pytest.mark.all  # Not a core test as per requirements
    def test_empty_message_parts(sut_client):
        """
        A2A JSON-RPC Spec: Business Logic Validation
        Test that the SUT properly handles a message with empty parts array.
    
        Per A2A specification, a message MUST contain at least one part.
        The SUT MUST reject messages with empty parts arrays.
        """
        # Create a message with empty parts array (violates A2A MUST requirement)
        params = {
            "message": {
                "messageId": "test-empty-parts-message-id-" + str(uuid.uuid4()),
                "role": "user",
                "parts": []
            }
        }
    
        req = message_utils.make_json_rpc_request("message/send", params=params)
        resp = sut_client.send_json_rpc(**req)
    
        # Per A2A spec, this MUST be rejected with InvalidParams error
>       assert message_utils.is_json_rpc_error_response(resp, expected_id=req["id"]), \
            f"SUT MUST reject messages with empty parts array per A2A spec, but got: {resp}"
E       AssertionError: SUT MUST reject messages with empty parts array per A2A spec, but got: {'id': '0ebab715-2feb-419b-b562-5662b0fe633f', 'jsonrpc': '2.0', 'result': {'artifacts': [{'artifactId': 'd42925c8-53c0-4c50-b8d2-5c3b406306ac', 'description': 'Agent response to user message.', 'name': 'response', 'parts': [{'kind': 'text', 'text': 'Hello! Please provide a message for me to respond to.'}]}], 'contextId': 'f2ddeb00-bb70-4171-960c-9efc1ffb61b0', 'history': [{'contextId': 'f2ddeb00-bb70-4171-960c-9efc1ffb61b0', 'kind': 'message', 'messageId': 'test-empty-parts-message-id-be1adf17-36e5-4ebb-8409-a7e1e2a6f489', 'parts': [], 'role': 'user', 'taskId': '3a2d92c7-20f4-45db-98ce-7efff282cdf3'}], 'id': '3a2d92c7-20f4-45db-98ce-7efff282cdf3', 'kind': 'task', 'status': {'message': {'contextId': 'f2ddeb00-bb70-4171-960c-9efc1ffb61b0', 'kind': 'message', 'messageId': '0ff9c175-e074-4b1b-907e-86398bc53108', 'parts': [{'kind': 'text', 'text': 'Hello! Please provide a message for me to respond to.'}], 'role': 'agent', 'taskId': '3a2d92c7-20f4-45db-98ce-7efff282cdf3'}, 'state': 'completed'}}}
E       assert False
E        +  where False = <function is_json_rpc_error_response at 0x7fccda0d4400>({'id': '0ebab715-2feb-419b-b562-5662b0fe633f', 'jsonrpc': '2.0', 'result': {'artifacts': [{'artifactId': 'd42925c8-53c0-4c50-b8d2-5c3b406306ac', 'description': 'Agent response to user message.', 'name': 'response', 'parts': [{'kind': 'text', 'text': 'Hello! Please provide a message for me to respond to.'}]}], 'contextId': 'f2ddeb00-bb70-4171-960c-9efc1ffb61b0', 'history': [{'contextId': 'f2ddeb00-bb70-4171-960c-9efc1ffb61b0', 'kind': 'message', 'messageId': 'test-empty-parts-message-id-be1adf17-36e5-4ebb-8409-a7e1e2a6f489', 'parts': [], ...}], 'id': '3a2d92c7-20f4-45db-98ce-7efff282cdf3', ...}}, expected_id='0ebab715-2feb-419b-b562-5662b0fe633f')
E        +    where <function is_json_rpc_error_response at 0x7fccda0d4400> = message_utils.is_json_rpc_error_response

tests/test_invalid_business_logic.py:105: AssertionError
__________________________ test_missing_method_field ___________________________

sut_client = <tck.sut_client.SUTClient object at 0x7fccda07e690>
text_message_params = {'message': {'messageId': 'test-protocol-message-id-a0a43e48-38e2-4383-a2fc-13df5787c335', 'parts': [{'kind': 'text', 'text': 'Hello from protocol violation test!'}], 'role': 'user'}}

    @pytest.mark.all  # Not a core test
    def test_missing_method_field(sut_client, text_message_params):
        """
        Test SUT's response to a request missing the method field.
    
        Per JSON-RPC 2.0 specification, the method field is REQUIRED.
        The SUT MUST reject requests missing required fields.
        """
        # Create a valid request first
        req = message_utils.make_json_rpc_request("message/send", params=text_message_params)
    
        # Remove the method field (violates JSON-RPC 2.0 MUST requirement)
        req.pop("method")
    
        # Send the malformed request using raw JSON-RPC method
        resp = sut_client.send_raw_json_rpc(req)
    
        # Per JSON-RPC 2.0 spec, this MUST be rejected with InvalidRequest error
>       assert message_utils.is_json_rpc_error_response(resp, expected_id=req["id"]), \
            f"SUT MUST reject requests missing required 'method' field per JSON-RPC 2.0 spec, but got: {resp}"
E       AssertionError: SUT MUST reject requests missing required 'method' field per JSON-RPC 2.0 spec, but got: {'id': '42176156-6781-48f4-9827-14392010006d', 'jsonrpc': '2.0', 'result': {'artifacts': [{'artifactId': 'c99c6228-6c50-4b84-b33a-e25e6aae0c80', 'description': 'Agent response to user message.', 'name': 'response', 'parts': [{'kind': 'text', 'text': 'Hello World! Nice to meet you!'}]}], 'contextId': 'fceef27b-120e-4b2e-8a09-b6e00a59079d', 'history': [{'contextId': 'fceef27b-120e-4b2e-8a09-b6e00a59079d', 'kind': 'message', 'messageId': 'test-protocol-message-id-a0a43e48-38e2-4383-a2fc-13df5787c335', 'parts': [{'kind': 'text', 'text': 'Hello from protocol violation test!'}], 'role': 'user', 'taskId': 'd42e2401-180b-483d-93cd-9fd9f6b26779'}], 'id': 'd42e2401-180b-483d-93cd-9fd9f6b26779', 'kind': 'task', 'status': {'message': {'contextId': 'fceef27b-120e-4b2e-8a09-b6e00a59079d', 'kind': 'message', 'messageId': 'f163df8a-a9b2-492c-a820-f1176831e092', 'parts': [{'kind': 'text', 'text': 'Hello World! Nice to meet you!'}], 'role': 'agent', 'taskId': 'd42e2401-180b-483d-93cd-9fd9f6b26779'}, 'state': 'completed'}}}
E       assert False
E        +  where False = <function is_json_rpc_error_response at 0x7fccda0d4400>({'id': '42176156-6781-48f4-9827-14392010006d', 'jsonrpc': '2.0', 'result': {'artifacts': [{'artifactId': 'c99c6228-6c50-4b84-b33a-e25e6aae0c80', 'description': 'Agent response to user message.', 'name': 'response', 'parts': [{'kind': 'text', 'text': 'Hello World! Nice to meet you!'}]}], 'contextId': 'fceef27b-120e-4b2e-8a09-b6e00a59079d', 'history': [{'contextId': 'fceef27b-120e-4b2e-8a09-b6e00a59079d', 'kind': 'message', 'messageId': 'test-protocol-message-id-a0a43e48-38e2-4383-a2fc-13df5787c335', 'parts': [{'kind': 'text', 'text': 'Hello from protocol violation test!'}], ...}], 'id': 'd42e2401-180b-483d-93cd-9fd9f6b26779', ...}}, expected_id='42176156-6781-48f4-9827-14392010006d')
E        +    where <function is_json_rpc_error_response at 0x7fccda0d4400> = message_utils.is_json_rpc_error_response

tests/test_protocol_violations.py:115: AssertionError
______________________ test_set_push_notification_config _______________________

sut_client = <tck.sut_client.SUTClient object at 0x7fccd9fdd650>
created_task_id = '07b8cfc7-cd5e-4664-b588-f24fe9c550e0'
agent_card_data = {'capabilities': {'streaming': True}, 'defaultInputModes': ['text'], 'defaultOutputModes': ['text'], 'description': 'A...plete A2A agent implementation designed specifically for testing with the A2A Technology Compatibility Kit (TCK)', ...}

    def test_set_push_notification_config(sut_client, created_task_id, agent_card_data):
        """
        A2A JSON-RPC Spec: tasks/pushNotificationConfig/set
        Test setting push notification config for a valid task.
        Expect echoed config in result or UnsupportedOperationError if not supported.
    
        A2A Specification Compliance: If the agent supports push notification functionality,
        it MUST declare pushNotifications capability in the Agent Card. This test will FAIL
        (not skip) if the capability is missing but the agent actually supports push notifications.
        """
        # Check if push notifications are supported
        push_supported = has_push_notification_support(agent_card_data)
    
        # A2A Specification Compliance Check
        if agent_card_data is not None and not push_supported:
>           pytest.fail(
                "Agent doesn't declare pushNotifications capability in Agent Card. "
                "A2A specification requires agents to declare all supported capabilities. "
                "If the agent supports push notifications, add 'capabilities.pushNotifications: true' to Agent Card. "
                "If the agent doesn't support push notifications, this test should return PushNotificationNotSupportedError."
            )
E           Failed: Agent doesn't declare pushNotifications capability in Agent Card. A2A specification requires agents to declare all supported capabilities. If the agent supports push notifications, add 'capabilities.pushNotifications: true' to Agent Card. If the agent doesn't support push notifications, this test should return PushNotificationNotSupportedError.

tests/test_push_notification_config_methods.py:56: Failed
______________________ test_get_push_notification_config _______________________

sut_client = <tck.sut_client.SUTClient object at 0x7fccd9fdd650>
created_task_id = '1a721286-757b-4c09-80db-d43c8062e93f'
agent_card_data = {'capabilities': {'streaming': True}, 'defaultInputModes': ['text'], 'defaultOutputModes': ['text'], 'description': 'A...plete A2A agent implementation designed specifically for testing with the A2A Technology Compatibility Kit (TCK)', ...}

    def test_get_push_notification_config(sut_client, created_task_id, agent_card_data):
        """
        A2A JSON-RPC Spec: tasks/pushNotificationConfig/get
        Test getting push notification config for a valid task.
        Expect config in result or UnsupportedOperationError if not supported.
    
        A2A Specification Compliance: If the agent supports push notification functionality,
        it MUST declare pushNotifications capability in the Agent Card.
        """
        # Check if push notifications are supported
        push_supported = has_push_notification_support(agent_card_data)
    
        # A2A Specification Compliance Check
        if agent_card_data is not None and not push_supported:
>           pytest.fail(
                "Agent doesn't declare pushNotifications capability in Agent Card. "
                "A2A specification requires agents to declare all supported capabilities. "
                "If the agent supports push notifications, add 'capabilities.pushNotifications: true' to Agent Card. "
                "If the agent doesn't support push notifications, this test should return PushNotificationNotSupportedError."
            )
E           Failed: Agent doesn't declare pushNotifications capability in Agent Card. A2A specification requires agents to declare all supported capabilities. If the agent supports push notifications, add 'capabilities.pushNotifications: true' to Agent Card. If the agent doesn't support push notifications, this test should return PushNotificationNotSupportedError.

tests/test_push_notification_config_methods.py:112: Failed
________________ test_set_push_notification_config_nonexistent _________________

sut_client = <tck.sut_client.SUTClient object at 0x7fccd9fdd650>
agent_card_data = {'capabilities': {'streaming': True}, 'defaultInputModes': ['text'], 'defaultOutputModes': ['text'], 'description': 'A...plete A2A agent implementation designed specifically for testing with the A2A Technology Compatibility Kit (TCK)', ...}

    def test_set_push_notification_config_nonexistent(sut_client, agent_card_data):
        """
        A2A JSON-RPC Spec: tasks/pushNotificationConfig/set
        Test setting push notification config for a non-existent task.
        Expect TaskNotFoundError or UnsupportedOperationError.
    
        A2A Specification Compliance: If the agent supports push notification functionality,
        it MUST declare pushNotifications capability in the Agent Card.
        """
        # Check if push notifications are supported
        push_supported = has_push_notification_support(agent_card_data)
    
        # A2A Specification Compliance Check
        if agent_card_data is not None and not push_supported:
>           pytest.fail(
                "Agent doesn't declare pushNotifications capability in Agent Card. "
                "A2A specification requires agents to declare all supported capabilities. "
                "If the agent supports push notifications, add 'capabilities.pushNotifications: true' to Agent Card. "
                "If the agent doesn't support push notifications, this test should return PushNotificationNotSupportedError."
            )
E           Failed: Agent doesn't declare pushNotifications capability in Agent Card. A2A specification requires agents to declare all supported capabilities. If the agent supports push notifications, add 'capabilities.pushNotifications: true' to Agent Card. If the agent doesn't support push notifications, this test should return PushNotificationNotSupportedError.

tests/test_push_notification_config_methods.py:160: Failed
________________ test_get_push_notification_config_nonexistent _________________

sut_client = <tck.sut_client.SUTClient object at 0x7fccd9fdd650>
agent_card_data = {'capabilities': {'streaming': True}, 'defaultInputModes': ['text'], 'defaultOutputModes': ['text'], 'description': 'A...plete A2A agent implementation designed specifically for testing with the A2A Technology Compatibility Kit (TCK)', ...}

    def test_get_push_notification_config_nonexistent(sut_client, agent_card_data):
        """
        A2A JSON-RPC Spec: tasks/pushNotificationConfig/get
        Test getting push notification config for a non-existent task.
        Expect TaskNotFoundError or UnsupportedOperationError.
    
        A2A Specification Compliance: If the agent supports push notification functionality,
        it MUST declare pushNotifications capability in the Agent Card.
        """
        # Check if push notifications are supported
        push_supported = has_push_notification_support(agent_card_data)
    
        # A2A Specification Compliance Check
        if agent_card_data is not None and not push_supported:
>           pytest.fail(
                "Agent doesn't declare pushNotifications capability in Agent Card. "
                "A2A specification requires agents to declare all supported capabilities. "
                "If the agent supports push notifications, add 'capabilities.pushNotifications: true' to Agent Card. "
                "If the agent doesn't support push notifications, this test should return PushNotificationNotSupportedError."
            )
E           Failed: Agent doesn't declare pushNotifications capability in Agent Card. A2A specification requires agents to declare all supported capabilities. If the agent supports push notifications, add 'capabilities.pushNotifications: true' to Agent Card. If the agent doesn't support push notifications, this test should return PushNotificationNotSupportedError.

tests/test_push_notification_config_methods.py:211: Failed
___________________________ test_task_history_length ___________________________

sut_client = <tck.sut_client.SUTClient object at 0x7fccda071d30>
text_message_params = {'message': {'messageId': 'test-state-message-id-c43b482d-6e35-4219-a154-7ce5cfdeb241', 'parts': [{'kind': 'text', 'te...rom TCK state transition test!'}], 'role': 'user', 'taskId': 'test-history-task-0b9cab87-3da1-47f4-8d8f-a3b2d8f9f500'}}

    @pytest.mark.core
    def test_task_history_length(sut_client, text_message_params):
        """
        MANDATORY: A2A Specification Section 7.3 - historyLength parameter
    
        The A2A specification states that tasks/get MUST support the historyLength parameter
        to limit the number of history entries returned.
    
        Test that the historyLength parameter in tasks/get properly limits the history entries returned.
        """
        # Step 1: Create a new task with an explicit taskId
        task_id = "test-history-task-" + str(uuid.uuid4())
        create_params = text_message_params.copy()
        create_params["message"]["taskId"] = task_id
    
        create_req = message_utils.make_json_rpc_request("message/send", params=create_params)
        create_resp = sut_client.send_json_rpc(method=create_req["method"], params=create_req["params"], id=create_req["id"])
        assert message_utils.is_json_rpc_success_response(create_resp, expected_id=create_req["id"])
    
        # Step 2: Send additional messages to build up history
        for i in range(3):
            follow_up_params = {
                "message": {
                    "taskId": task_id,
                    "messageId": f"test-history-message-{i+1}-" + str(uuid.uuid4()),
                    "role": "user",
                    "parts": [
                        {
                            "kind": "text",
                            "text": f"Follow-up message {i+1}"
                        }
                    ]
                }
            }
            update_req = message_utils.make_json_rpc_request("message/send", params=follow_up_params)
            update_resp = sut_client.send_json_rpc(method=update_req["method"], params=update_req["params"], id=update_req["id"])
            assert message_utils.is_json_rpc_success_response(update_resp, expected_id=update_req["id"])
            time.sleep(0.5)  # Brief pause between messages
    
        # Step 3: Get task with full history
        get_full_req = message_utils.make_json_rpc_request("tasks/get", params={"id": task_id})
        get_full_resp = sut_client.send_json_rpc(method=get_full_req["method"], params=get_full_req["params"], id=get_full_req["id"])
        assert message_utils.is_json_rpc_success_response(get_full_resp, expected_id=get_full_req["id"])
        full_history = get_full_resp["result"].get("history", [])
    
        # Step 4: Get task with limited history (historyLength=2)
        get_limited_req = message_utils.make_json_rpc_request("tasks/get", params={"id": task_id, "historyLength": 2})
        get_limited_resp = sut_client.send_json_rpc(method=get_limited_req["method"], params=get_limited_req["params"], id=get_limited_req["id"])
        assert message_utils.is_json_rpc_success_response(get_limited_resp, expected_id=get_limited_req["id"])
        limited_history = get_limited_resp["result"].get("history", [])
    
        # Verify that limited history contains at most 2 entries
>       assert len(limited_history) <= 2, f"Limited history should have at most 2 entries, but has {len(limited_history)}"
E       AssertionError: Limited history should have at most 2 entries, but has 5
E       assert 5 <= 2
E        +  where 5 = len([{'contextId': '1a25dc88-ef8b-4b97-b206-dd58dfd90c53', 'kind': 'message', 'messageId': 'test-state-message-id-c43b482d-6e35-4219-a154-7ce5cfdeb241', 'parts': [{'kind': 'text', 'text': 'Hello from TCK state transition test!'}], ...}, {'contextId': '1a25dc88-ef8b-4b97-b206-dd58dfd90c53', 'kind': 'message', 'messageId': 'f3852df3-e801-40a3-a980-9fa455666814', 'parts': [{'kind': 'text', 'text': 'Hello World! Nice to meet you!'}], ...}, {'contextId': 'c09a5288-2099-4a30-b76f-1e5899ef85fb', 'kind': 'message', 'messageId': 'test-history-message-1-127f2546-5201-4bae-a641-bfef3fbfc4da', 'parts': [{'kind': 'text', 'text': 'Follow-up message 1'}], ...}, {'contextId': 'a85cbf25-0837-4d3c-9b50-ce1ba4cb794c', 'kind': 'message', 'messageId': 'test-history-message-2-a649ce77-0f1b-419b-80a9-8220795bb1e8', 'parts': [{'kind': 'text', 'text': 'Follow-up message 2'}], ...}, {'contextId': 'dda977a3-2d27-4a71-98ed-07980fe6c7c3', 'kind': 'message', 'messageId': 'test-history-message-3-3d598eef-5718-4c42-93ac-796115618b12', 'parts': [{'kind': 'text', 'text': 'Follow-up message 3'}], ...}])

tests/test_state_transitions.py:164: AssertionError
______________________ test_tasks_resubscribe_nonexistent ______________________

async_http_client = <httpx.AsyncClient object at 0x7fccd9ee68b0>
agent_card_data = {'capabilities': {'streaming': True}, 'defaultInputModes': ['text'], 'defaultOutputModes': ['text'], 'description': 'A...plete A2A agent implementation designed specifically for testing with the A2A Technology Compatibility Kit (TCK)', ...}

    @pytest.mark.asyncio
    async def test_tasks_resubscribe_nonexistent(async_http_client, agent_card_data):
        """
        A2A JSON-RPC Spec: tasks/resubscribe for non-existent task
        Test the SUT's handling of a resubscribe request for a task that doesn't exist.
        Expect a JSON-RPC error with TaskNotFoundError or similar.
    
        A2A Specification Compliance: If the agent supports streaming functionality,
        it MUST declare streaming capability in the Agent Card.
        """
        # A2A Specification Compliance Check
        if not has_streaming_support(agent_card_data):
            pytest.fail(
                "Agent doesn't declare streaming capability in Agent Card. "
                "A2A specification requires agents to declare all supported capabilities. "
                "If the agent supports streaming, add 'capabilities.streaming: true' to Agent Card. "
                "If the agent doesn't support streaming, this test should return HTTP 501 or MethodNotFound."
            )
    
        # Mark as core since we've confirmed streaming is supported
        pytestmark = pytest.mark.core
    
        # Use a random, non-existent task ID
        task_id = "non-existent-task-id-" + message_utils.generate_request_id()
    
        resubscribe_params = {"id": task_id}
        req_id = message_utils.generate_request_id()
        json_rpc_request = message_utils.make_json_rpc_request("tasks/resubscribe", params=resubscribe_params, id=req_id)
    
        sut_url = config.get_sut_url()
        headers = {"Content-Type": "application/json"}
    
        try:
            response = await async_http_client.post(
                sut_url,
                json=json_rpc_request,
                headers=headers,
                timeout=10  # Use timeout here since we expect an error
            )
    
            # We expect a JSON-RPC error for a non-existent task, not a stream
>           assert not response.headers.get("content-type", "").startswith("text/event-stream")
E           AssertionError: assert not True
E            +  where True = <built-in method startswith of str object at 0x7fccd9f52ab0>('text/event-stream')
E            +    where <built-in method startswith of str object at 0x7fccd9f52ab0> = 'text/event-stream; charset=utf-8'.startswith
E            +      where 'text/event-stream; charset=utf-8' = get('content-type', '')
E            +        where get = Headers({'date': 'Thu, 29 May 2025 13:15:10 GMT', 'server': 'uvicorn', 'cache-control': 'no-store', 'connection': 'keep-alive', 'x-accel-buffering': 'no', 'content-type': 'text/event-stream; charset=utf-8', 'transfer-encoding': 'chunked'}).get
E            +          where Headers({'date': 'Thu, 29 May 2025 13:15:10 GMT', 'server': 'uvicorn', 'cache-control': 'no-store', 'connection': 'keep-alive', 'x-accel-buffering': 'no', 'content-type': 'text/event-stream; charset=utf-8', 'transfer-encoding': 'chunked'}) = <Response [200 OK]>.headers

tests/test_streaming_methods.py:426: AssertionError
_________________________ test_https_url_in_agent_card _________________________

sut_client = <tck.sut_client.SUTClient object at 0x7fccda115e50>
agent_card_data = {'capabilities': {'streaming': True}, 'defaultInputModes': ['text'], 'defaultOutputModes': ['text'], 'description': 'A...plete A2A agent implementation designed specifically for testing with the A2A Technology Compatibility Kit (TCK)', ...}

    def test_https_url_in_agent_card(sut_client, agent_card_data):
        """
        A2A Protocol Specification: Transport Security and Agent Card
    
        Test that the URLs in the Agent Card use HTTPS.
    
        This validates that the agent's self-reported URLs in the Agent Card
        follow security best practices by using HTTPS.
        """
        if agent_card_data is None:
            pytest.skip("Agent Card data is not available")
    
        # Check URL field if present
        if "url" in agent_card_data:
            url = agent_card_data["url"]
>           assert url.startswith("https://"), f"Agent Card URL should use HTTPS: {url}"
E           AssertionError: Agent Card URL should use HTTPS: http://localhost:9999/
E           assert False
E            +  where False = <built-in method startswith of str object at 0x7fccda122ff0>('https://')
E            +    where <built-in method startswith of str object at 0x7fccda122ff0> = 'http://localhost:9999/'.startswith

tests/test_transport_security.py:115: AssertionError
=========================== short test summary info ============================
FAILED tests/test_edge_cases.py::test_empty_arrays - AssertionError: assert F...
FAILED tests/test_edge_cases.py::test_boundary_values - assert False
FAILED tests/test_invalid_business_logic.py::test_unsupported_part_kind - Ass...
FAILED tests/test_invalid_business_logic.py::test_empty_message_parts - Asser...
FAILED tests/test_protocol_violations.py::test_missing_method_field - Asserti...
FAILED tests/test_push_notification_config_methods.py::test_set_push_notification_config
FAILED tests/test_push_notification_config_methods.py::test_get_push_notification_config
FAILED tests/test_push_notification_config_methods.py::test_set_push_notification_config_nonexistent
FAILED tests/test_push_notification_config_methods.py::test_get_push_notification_config_nonexistent
FAILED tests/test_state_transitions.py::test_task_history_length - AssertionE...
FAILED tests/test_streaming_methods.py::test_tasks_resubscribe_nonexistent - ...
FAILED tests/test_transport_security.py::test_https_url_in_agent_card - Asser...
======== 12 failed, 53 passed, 7 skipped, 3 xfailed in 62.32s (0:01:02) ========
Running command: pytest --sut-url http://localhost:9999 --test-scope all -v
